<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Responsible Prompting - Multi-Turn Chat</title>

    <!-- IBM Plex Sans -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600&display=swap"
        rel="stylesheet" />

    <!-- Carbon CSS (for tabs and tags) -->
    <link rel="stylesheet" href="./../styles/carbon-components.min.css"/>

    <link rel="stylesheet" href="./../styles/style_multiturn.css"/>

    <script type="text/javascript" src="./js/d3.v7.min.js"></script>
    <script type="text/javascript" src="./js/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="./js/main.js"></script>
</head>

<body>
    <div id="tooltip" style="opacity: 0;" class="tooltip"></div>
    <!-- ===== Header: Title + Carbon Tabs ===== -->
    <div class="header-container">
        <div style="display: flex; flex-direction: row;">
            <h4 style="width: 40%; display: flex; padding-left: 1rem; font-size: xx-large; font-weight: 300;">Responsible Prompting</h4>
            <div style="width: 60%; padding-left: 1rem;" class="intro">
                <p>
                    Please provide a prompt that would be sent to an LLM. Recommendations are performed in prompting-time, before content generation. The recommendations consider a curated dataset of values and prompt sentences. They are based on the similarity between your input and that dataset.
                </p>
            </div>
        </div>
    </div>

        <!-- === Chat View === -->
        <div id="chat-content">
            <div id="chat" class="chat-container"></div>

            <!-- Input area -->
            <div class="input-area">
                <div id="userInput">
                    <div id="userInputDiv" contenteditable="true" placeholder="Enter your prompt">Act as a professional designer with 20 years of experience creating and testing UX interfaces and landing sites for a variety of IT applications. We are in need of more people and an increased budget to be able to keep up with clients' needs. What kind of evidence should I gather to support my demands to gain more resources?
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; gap: 1rem;">
                    <div id="recommendation"></div>
                    <select id="modelSelect"></select>
                    <!-- Send button -->
                    <button id="sendBtn" class="btn" disabled>
                        <img src="./imgs/send.svg" alt="Send" class="icon"/>
                    </button>
                </div>
            </div>
        </div>

    <script>
        var modelId = '';
        document.addEventListener('DOMContentLoaded', () => {
            // Populate the different models options
            // id -> id of the model on HF, name -> name displayed to the user
            const models = [
                { id: 'mistralai/Mistral-7B-Instruct-v0.3', name: 'Mistral 7B Instruct v0.3' },
                { id: 'meta-llama/Llama-4-Scout-17B-16E-Instruct', name: 'Llama 4 Scout' },
            ];
            const modelSelect = document.getElementById('modelSelect');

            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.id;
                option.textContent = model.name;
                modelSelect.appendChild(option);
            });

            // Set default selection
            modelId = models[0].id;

            // Record when model changes
            modelSelect.addEventListener('change', function() {
                const selectedModel = models.find(model => model.id === this.value);
                modelId = selectedModel.id;
            });
        });

        // To show the bottom of text in the prompt input box
        var objDiv = document.getElementById("userInputDiv");
        objDiv.scrollTop = objDiv.scrollHeight;
        $("#userInputDiv").trigger("input");

        $("#userInputDiv").on("input", () => generateRecommendations("#sendBtn", "#userInputDiv", "#recommendation"));

        // To generate recommendation when the page loads
        $("#userInputDiv").trigger('input');

        $("#sendBtn").on("click", () => {
            const rawText = $("#userInputDiv").text() || "";
            
            // Clear input box and recommendations
            $("#userInputDiv").text("");
            $("#recommendation").empty();
            $("#sendBtn").attr("disabled", true);

            // Generate LLM response
            generateResponse(rawText, "#chat");
        });
        
        // Pressing Enter (without Shift) also sends
        $("#userInput").on("keydown", function (e) {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                if (!$("#sendBtn").attr("disabled")) {
                    $("#sendBtn").click();
                }
            }
        });
    </script>
</body>

</html>